Attention:
This program needs to be used with Cavity.
The program of Cavity can be downloaded freely from http://mdl.ipc.pku.edu.cn/mdlweb/download.php
In order to use the running script conveniently, please put these two unpacked program into the same path with this instruction file. The default Cavity program directory name is "Cavity". Thanks for your cooperation.

Instructions:
1. Define the target protein's orthosteric site and detect cavitites of proteins by Cavity.
2. Calucate correlations between the orthosteric site and detected cavities by using:
   sh ./run.sh
The example is 1T49. The calculated result is in the file whose name is summary_1T49_all_fix.dat 


The GNM part is based on the code writen by Eran Eyal (2006) eyal@pitt.edu. The following instructions are also modified from him.
 
Compilation:
cc -lm -O2 -o gnm_index gnm_index.c
cc -lm -O2 -o gnm_occ gnm_occ.c

Run:
gnm_index [pdb_file] [chain] [model]
gnm_occ [pdb_file] [chain] [model] [orthosteric site indexfile] [cavity indexfile] 

Note:
The pdb file should be in the current directory. 
Chain must be specified. If the chain is the space character you have to put " " (you need to
put the "" in the command line) in the second parameter. To model all chains in the file use "*" (again, you need to
put the "" in the command line).
The model also nust be specified. If there is no model or you want to consider residues in
all models use the 0 value for the third argument.

Example:

gnm_index 1t49.pdb "*" 0

will model all the nodes (as defined in nodes.txt) in all the chains and all nodels of pdb file 1t49.pdb.  


gnm_occ 1t49.pdb "*" 0 1t49_orthosteric.dat 1t49_cavity2.dat

will model all the nodes(as defined in nodes.txt) in all the chains and all nodels of pdb file 1t49.pdb, and calculate correlations between orthosteric site and cavity2.

The input file nodes.txt defines the nodes in the system and the cutoffs. for example:
#ATM CUTOFF  
#%4S%5.2f
 CA  3.65
 P   5.00
defines that CA atoms and P atoms are nodes.
The cutoff distance of the program to determine contact between pairs of atoms is the sum of the atomic cutoffs in this file.
for example, here the interaction cutoff between two CA atoms will be 3.65A+3.65A=7.3A and for interactions between CA and P 
will be 3.65A+5A=8.65A

The output files include:

pdb_file.kirchhof:         the Kirchhof matrix of the system
pdb_file.sparsekirchhof:   the Kirchhof matrix of the system in a sparse format (i j value).
pdb_file.index:            defines the nodes and include also coordinates and b-factor information
pdb_file.log               give basic information about this run
pdb_file.invkirchhof       the psudo inverse of the Kirchhof (the covariance matrix)
pdb_file.modes             list the mean self square fluctuations of each residue in each mode 
                           (the diagonal of the outer product of each mode)
pdb_file.crosscorrelations normailzed covariance matrix:  crosscorrelations(i,j) = invkirchhof(i,j)/sqrt(invkirchhof(i,i)*invkirchhof(j,j))
pdb_file.eigenvectors      complete eigenvectors (including the first one). Eigenvectors are listed as columns.
pdb_file.eigenvalues       eigenvalues (including the first zero eigenvalue).
pdb_file.tc_as             normailzed correlations between orthosteric site and cavity in each mode

2.  Construction of a Kirchhof matrix. Appropriate for large systems, where the eigen problem should be solved by other
application

Compilation:
cc -lm -02 -o gnm_kirchhof_econo gnm_kirchhof_econo.c

Run:
gnm_kirchhof_econo [pdb_file] [chain] [model] 

Note:
The pdb file should be in the current directory. 
Chain must be specified. If the chain is the space character you have to put " " (you need to
put the "" in the command line) in the second parameter. To model all chains in the file use "*" (again, you need to
put the "" in the command line).
The model also nust be specified. If there is no model or you want to consider residues in
all models use the 0 value for the third argument.

Example:

gnm_kirchhof_econo 1t49.pdb "*" 0

will create the Kirchhof matrix based on the nodes (as defined in nodes.txt) in all the chains and all nodels of pdb file 1t49.pdb.  

The input file nodes.txt defines the nodes in the system and the cutoffs. for example:
#ATM CUTOFF  
#%4S%5.2f
 CA  3.65
 P   5.00
defines that CA atoms and P atoms are nodes.
The cutoff distance of the program to determine contact between pairs of atoms is the sum of the atomic cutoffs in this file.
for example, here the interaction cutoff between two CA atoms will be 3.65A+3.65A=7.3A and for interactions between CA and P 
will be 3.65A+5A=8.65A

The output files include
pdb_file.sparsekirchhof: the Kirchhof matrix of the system in a sparse format (i j value).
pdb_file.index:          defines the nodes and include also coordinates and b-factor information
pdb_file.log             give basic information about this run


3. A Matlab code to call the function the retrieve a subset of modes (eigenvalues and eigenvectors) .Uses the eigs function of Matlab (which uses ARPACK). The input is a sparse matrix.

To functions are 
useeigs.m  (call the eigs function)
readhes.m  (parse the Kirchhof matrix)

To call the function within matlab:

useeigs ('pdb_file.sparsekirchhof' , neigen) ;

'pdb_file.sparsekirchhof' is the file obtained from gnm_kirchhof_econo. neigen is the number of slow modes requested.

The matlab code creates 3 output files:

anmeigs.flag:            a flag to indicate a success run (0 value)
anmeigs.eigenvectors:    eigen vectors (listed as columns, including the first constant one)
anmeigs.eigenvalues:     eigen values  (including the zero eigenvalue).

Refer to the Matlab documentation for more help regarding the matlab code.


The code and documentation were written by Eran Eyal (2006) eyal@pitt.edu and modified by Xiaomin Ma(2014) xmma89@pku.edu.cn

Source code copyright University of Pittsburgh and Peking University, released under the GPL terms,
see license_eyal.txt.
